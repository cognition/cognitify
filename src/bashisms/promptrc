#!/bin/bash

export PROMPT_VERSION=1

## (C) 2023
## Ramon Brooker <rbrooker@aeo3.io>
# shellcheck source=/dev/null

source /etc/environment
source /etc/bash.bashrc.d/lib/colourrc

force_color_prompt=yes

if [ -n "$force_color_prompt" ]; then
    if [ -x /usr/bin/tput ] && tput setaf 1 >&/dev/null; then
        export color_prompt=yes
    else
        export color_prompt=
    fi
fi

HOSTNAME_TWO='[38;5;29m\]'
DEFAULT_USERNAME_COLOUR='[38;5;247m\]'
TEXT_COLOUR='[38;5;254m\]'

### Username Colour from ~/.over-ride

if [[ ! -z ${OVERRIDE_USERNAME_COLOUR} ]]; then

    USERNAME_COLOUR=${OVERRIDE_USERNAME_COLOUR}

else
    USERNAME_COLOUR=${DEFAULT_USERNAME_COLOUR}
fi

### Hostname Colour from ~/.over-ride
if [[ ! -z ${OVERRIDE_HOSTNAME_COLOUR} ]]; then
    HOSTNAME_COLOUR=${OVERRIDE_HOSTNAME_COLOUR}
elif [[ ${HOSTNAME_NUMBER} = "2" ]]; then
    HOSTNAME_COLOUR=${HOSTNAME_TWO}
else
    HOSTNAME_COLOUR=${OLIVE}
fi

### PWD Colour from ~/.over-ride
if [[ -n ${OVERRIDE_PWD_COLOUR} ]]; then

    PWD_COLOUR=${OVERRIDE_PWD_COLOUR}

else
    PWD_COLOUR=${LT_BLUE}
fi

OPEN_BRACKET="${PS_SQUARE_BRACKETS}[${RESET}"
CLOSE_BRACKET="${RESET}${PS_SQUARE_BRACKETS}]${RESET}"

HOSTNAME_GRP="${COLOUR}${HOSTNAME_COLOUR}\h${RESET}"
PS_PWD="${COLOUR}${PWD_COLOUR}:\w ${RESET}"

USER_HOSTNAME="${OPEN_BRACKET}${HOSTNAME_GRP}${CLOSE_BRACKET} "
# export USER_HOSTNAME="${OPEN_BRACKET}${HOSTNAME_GRP}${CLOSE_BRACKET} ${RESET}"
USER_USER="${COLOUR}${USERNAME_COLOUR}\u${RESET}"
USER_PROMPT="${COLOUR}${USERNAME_COLOUR}\\$ ${RESET}"

ROOT_USER="${COLOUR}${ROOT_RED}\u${RESET}"
ROOT_PROMPT="${COLOUR}${ROOT_RED}\\$ ${RESET}"
ROOT_MESSAGE="${BOLD}${COLOUR}${ROOT_RED}_YOU_ARE_ROOT_ ${RESET}"
ROOT_FULL_MESSAGE="${ROOT_MESSAGE}${USER_HOSTNAME}"

if [[ -f ${HOME}/.no_root_message ]]; then
    ROOT_PS1="${USER_HOSTNAME} ${ROOT_USER}${PS_PWD}${ROOT_PROMPT}"
else
    ROOT_PS1="${ROOT_FULL_MESSAGE}${ROOT_USER}${PS_PWD}${ROOT_PROMPT}"
fi

USER_PS1="${USER_HOSTNAME}${USER_USER}${PS_PWD}${USER_PROMPT}"

## Prompt Definitions

### WSL Flavour Information

if [ "$color_prompt" = yes ]; then
    if [[ ${IS_WSL} = "FALSE" ]]; then
        if [ $UID = 0 ]; then
            export PS1="${ROOT_PS1}"
        else
            export PS1="${USER_PS1}"
        fi
    else
        ##  SYSTEM IS WSL
        WSL_MESSAGE="${YELLO}(${WSL_FLAVOUR}) ${RESET}"
        WSL_ROOT_PS1="${WSL_MESSAGE}${ROOT_FULL_MESSAGE}${ROOT_USER}${PS_PWD}${ROOT_PROMPT}"
        WSL_USER_PS1="${WSL_MESSAGE}${USER_PS1}"
        if [ $UID = 0 ]; then
            export PS1="${WSL_ROOT_PS1}"
        else
            export PS1="${WSL_USER_PS1}"
        fi
    fi
fi
unset color_prompt force_color_prompt
